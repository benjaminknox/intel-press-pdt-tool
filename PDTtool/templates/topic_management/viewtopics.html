{% extends "gui_base.html" %}
{% load staticfiles %}
{% load filters %}
{% load documents %}
{% block stylesheet %}
<link rel="stylesheet" href="{% static 'www/css/topics.style.css' %}" />
{% endblock %}
{% block content %}

{% if Program_Manager %}

<div class="screen box-shadow-5">

  <a href="javascript:void(0);" onclick="$(this).parent().hide();" class="btn btn-danger hide-button">hide</a>

  <h3 class="page-title"></h3>

  <div id="form_element" style="display: none;">
    <!-- To get the count I used an attribute called count, it is increment by jQuery and is the number of time #file_form_id has been copied -->
    <input type="file" name="element_form" id="file_form_id" count="0" class="file_form" onchange="$(this).hide(); clone_form($(this).val());" />
  </div><!-- #form_element -->

  <div id="add_topic_form">
    <!-- The main form, it does multiple file upload using a bit of JavaScript -->
    <form enctype="multipart/form-data" action="{{ request.get_full_path }}" method="POST" id="addtopicform_tag">
      {% csrf_token %}
      <table id="topic_info_table">
        {{ topicform.as_table }}
        <tr>
          <td colspan="2" class="submit_button_row"></td>
        </tr>
      </table><!-- #topic_info_table -->

      <div id="file_container">
      </div><!-- #file_container -->
        <table id="docs" class="table table-striped">
      </table><!-- #docs -->
      <center><input type="submit" value="Upload" class="btn btn-success" /></center>
    </form>
    <!-- End of the main form -->

    </form>
  </div><!-- #add_topic_form -->

</div><!-- .screen -->

{% endif %}

<div id="topic_toolbar">
  <div id="topic_form">
    <input type="text" class="pull-right" placeholder="Find" id="search_topics" onkeyup="search_topics($(this));" />
  </div><!--- #topic_form -->
</div><!-- #topic_toolbar -->

<div id="topic_content" class="border-radius-5 box-shadow-2">
  <div id="topic_sidebar">
    {% if Program_Manager %}
    <a href="javascript:edit_form();" class="btn btn-warning" id="create_button">
      Create 
    </a>
    {% endif %}
    {% for category in topic_categories %}
      <div class="topic_category" category="{{ category.name }}" onclick="select_category($(this));">
        {{ category.name }}
        <span class="pull-right bold-text">{{ category.count }}</span>
      </div><!-- .topic_category -->
    {% endfor %}
    <div class="topic_category" category="mytopics" onclick="select_category($(this));">
        My Topics
    </div>
    <div class="topic_category" category="all" onclick="select_category($(this));">
        All
    </div>
  </div><!-- #topic_sidebar -->

  <div id="topic_bin">
    <table id="list" class="table table-hover">
      <thead class="bordered-box">
        <th class="topic_name">Name<div class="arrow"></div></th>
        <th class="topic_owner">Owner<div class="arrow"></div></th>
        <th class="topic_category_col">Category<div class="arrow"></div></th>
        <th class="topic_status">Status<div class="arrow"></div></th>
      </thead>
      <tbody id="topic_bin_body">
        {% for topic in topics %}
        <tr class="topic topic-selected" category="{{ topic.category }}" onclick="window.location = '/viewtopic/?publicid={{ topic.publicid }}';"owner="{% if topic.user == request.user %}true{% else %}false {% endif %}">
          <td class="topic_name"><i class="topic-icon topic-icon-{{topic.category | replace:"/ /-" | lower }}"></i>&nbsp;{{ topic.name }}<small class="muted pull-right">{{ topic.topic_slug }}</small></td>
          <td class="topic_owner">{{ topic.user.get_full_name }}</td>
          <td class="topic_category_col">{{ topic.category }}</td>
          <td class="topic_status" onclick="window.location = '/viewtopic/publicid=';"><small>
            {% if  topic.supervisor_released %}
              <span class="text-success">Approved</span>
            {% endif %}
            {% if not  topic.supervisor_released and topic.readyforreview and not topic.meeting %}
              <span class="text-info">Needs Review</span>
            {% endif %}
            {% if not topic.supervisor_released and not topic.readyforreview  and not topic.meeting %}
              <span class="muted">In Progress</span>
            {% endif %}
            {% if topic.meeting %}
              <a class="text-error" href="/viewmeetings/?year={{ topic.meeting.startdate.year }}&month={{ topic.meeting.startdate.month }}#{{ topic.meeting.publicid }}">In Meeting</a>
            {% endif %}</small>
          </td>
        </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr >
          <td colspan="4"></td>
        </tr>
      </tfoot>
    </div><!-- #header -->
  </div><!-- #topic_bin -->

</div><!-- #content -->
{% endblock %}

{% block scripts %}
<script src="{% static 'www/js/jquery.sortElements.js' %}"></script>
<script src="{% static 'www/js/topics.ui.js' %}"></script>
<script src="{% static 'www/js/addtopic.js' %}"></script>
{% endblock %}